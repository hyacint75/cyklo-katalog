---
import BaseLayout from "../../../../layouts/BaseLayout.astro";
import ProductCard from "../../../../components/ProductCard.astro";
import { products } from "../../../../data/products";

export async function getStaticPaths() {
  const ITEMS_PER_PAGE = 6; // ← musí být tady

  const categories = [
    ...new Set(products.map((p) => p.category.toLowerCase())),
  ];

  const paths = [];

  for (const category of categories) {
    const categoryProducts = products.filter(
      (p) => p.category.toLowerCase() === category,
    );

    const totalPages = Math.ceil(categoryProducts.length / ITEMS_PER_PAGE);

    for (let page = 2; page <= totalPages; page++) {
      paths.push({
        params: {
          category,
          page: page.toString(),
        },
      });
    }
  }

  return paths;
}

const ITEMS_PER_PAGE = 6; // ← znovu definujeme pro render fázi

const { category, page } = Astro.params;
const currentPage = Number(page);

const categoryProducts = products.filter(
  (p) => p.category.toLowerCase() === category,
);

const totalPages = Math.ceil(categoryProducts.length / ITEMS_PER_PAGE);

const start = (currentPage - 1) * ITEMS_PER_PAGE;
const paginated = categoryProducts.slice(start, start + ITEMS_PER_PAGE);
---
